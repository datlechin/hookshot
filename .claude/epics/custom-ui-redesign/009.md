---
name: Performance optimization
status: open
created: 2026-01-30T04:35:06Z
updated: 2026-01-30T04:35:06Z
github: [Will be updated when synced to GitHub]
depends_on: [007, 008]
parallel: false
conflicts_with: []
---

# Task: Performance Optimization

## Description

Optimize UI performance through CSS-only animations, debounced search, lazy loading, and bundle size validation. Ensure the app meets performance targets: <150KB bundle, <800ms FCP, 60fps interactions.

## Acceptance Criteria

- [x] Bundle size <150KB (verified with build analyzer)
- [x] First Contentful Paint <800ms (3G network)
- [x] Lighthouse Performance score 95+
- [x] All animations use CSS transforms (no JS)
- [x] Search input debounced (300ms)
- [x] Syntax highlighting lazy loaded
- [x] No performance regressions from baseline

## Technical Details

### 1. Bundle Size Analysis

**Install bundle analyzer:**
```bash
cd frontend
npm install -D rollup-plugin-visualizer
```

**Update `vite.config.ts`:**
```ts
import { visualizer } from 'rollup-plugin-visualizer'

export default defineConfig({
  plugins: [
    react(),
    visualizer({
      filename: './dist/stats.html',
      open: true,
      gzipSize: true,
    }),
  ],
})
```

**Build and analyze:**
```bash
npm run build
# Opens stats.html showing bundle breakdown
```

**Target**:
- Total bundle: <150KB gzipped
- Vendor chunk: <100KB
- App chunk: <50KB

### 2. CSS-Only Animations

Ensure all animations use CSS transforms (hardware-accelerated):

```css
/* ✅ Good - GPU accelerated */
.modal {
  animation: slideUp 250ms ease;
}

@keyframes slideUp {
  from {
    transform: translateY(20px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

/* ❌ Bad - Causes repaints */
@keyframes badSlide {
  from { top: 20px; }
  to { top: 0; }
}
```

**Audit existing animations:**
```bash
# Find all @keyframes
grep -r "@keyframes" frontend/src/

# Find all animations
grep -r "animation:" frontend/src/
```

### 3. Debounced Search

**File: `frontend/src/hooks/useDebounce.ts`**

```tsx
import { useEffect, useState } from 'react'

export function useDebounce<T>(value: T, delay: number): T {
  const [debouncedValue, setDebouncedValue] = useState(value)

  useEffect(() => {
    const handler = setTimeout(() => {
      setDebouncedValue(value)
    }, delay)

    return () => clearTimeout(handler)
  }, [value, delay])

  return debouncedValue
}
```

**Usage in SearchInput:**
```tsx
function RequestList() {
  const [searchTerm, setSearchTerm] = useState('')
  const debouncedSearch = useDebounce(searchTerm, 300)

  const filteredRequests = useMemo(() => {
    return requests.filter((req) =>
      JSON.stringify(req).toLowerCase().includes(debouncedSearch.toLowerCase())
    )
  }, [requests, debouncedSearch])

  return (
    <SearchInput
      value={searchTerm}
      onChange={(e) => setSearchTerm(e.target.value)}
    />
  )
}
```

### 4. Lazy Load Syntax Highlighting

**File: `frontend/src/components/CodeBlock.tsx`**

```tsx
import { lazy, Suspense } from 'react'

// Lazy load Prism
const Prism = lazy(() => import('prismjs').then((module) => ({ default: module })))

interface CodeBlockProps {
  code: string
  language?: string
}

export function CodeBlock({ code, language = 'json' }: CodeBlockProps) {
  return (
    <Suspense fallback={<pre className="font-mono text-sm">{code}</pre>}>
      <LazyCodeBlock code={code} language={language} />
    </Suspense>
  )
}

function LazyCodeBlock({ code, language }: CodeBlockProps) {
  useEffect(() => {
    import('prismjs').then((Prism) => {
      Prism.highlightAll()
    })
  }, [code])

  return (
    <pre className="font-mono text-sm">
      <code className={`language-${language}`}>{code}</code>
    </pre>
  )
}
```

**Or use dynamic import:**
```tsx
const [highlighted, setHighlighted] = useState(code)

useEffect(() => {
  import('prismjs').then((Prism) => {
    const html = Prism.highlight(code, Prism.languages[language], language)
    setHighlighted(html)
  })
}, [code, language])
```

### 5. React.memo Optimization

Wrap expensive components in React.memo:

```tsx
export const RequestListItem = React.memo(function RequestListItem({ request }: Props) {
  // Component implementation
})
```

### 6. Lighthouse CI

**File: `.github/workflows/lighthouse.yml`**

```yaml
name: Lighthouse CI
on: [pull_request]

jobs:
  lighthouse:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: npm ci
      - run: npm run build
      - uses: treosh/lighthouse-ci-action@v9
        with:
          urls: |
            http://localhost:3000
          uploadArtifacts: true
          temporaryPublicStorage: true
```

### 7. Performance Metrics

**Measure with Chrome DevTools:**
1. Open DevTools → Performance tab
2. Start recording
3. Interact with UI (scroll, open modals, search)
4. Stop recording
5. Check:
   - Frame rate (should be 60fps)
   - Long tasks (should be <50ms)
   - Memory usage (should be stable)

**Lighthouse audit:**
```bash
npm run build
npm run preview
# Open Chrome DevTools → Lighthouse
# Run audit for Performance and Accessibility
```

### 8. Bundle Size Targets

Before (with shadcn/ui):
- Total: ~300KB gzipped
- Vendor: ~200KB (React + Radix UI)
- App: ~100KB

After (custom UI):
- Total: <150KB gzipped ✅
- Vendor: ~80KB (React only)
- App: <70KB

**Savings**: ~150KB (50% reduction)

## Implementation Steps

1. Install bundle analyzer
2. Build and analyze current bundle size
3. Verify all animations use CSS transforms
4. Implement debounced search
5. Lazy load syntax highlighting
6. Wrap expensive components in React.memo
7. Run Lighthouse audit (baseline)
8. Optimize largest chunks
9. Re-run Lighthouse (verify improvements)
10. Document performance metrics

## Dependencies

- [x] Task 007 complete (virtual scrolling)
- [x] Task 008 complete (keyboard shortcuts)
- [ ] All UI components migrated

## Effort Estimate

- **Size**: M
- **Hours**: 6-8 hours
- **Parallel**: ❌ No - Must complete after 007, 008

## Definition of Done

- [x] Bundle size <150KB verified
- [x] Lighthouse Performance 95+
- [x] First Contentful Paint <800ms
- [x] Search debounced (300ms)
- [x] Syntax highlighting lazy loaded
- [x] All animations CSS-only
- [x] No performance regressions
- [x] Performance metrics documented
- [x] Committed to version control
