---
name: Build layout components (Modal, Tabs)
status: open
created: 2026-01-30T04:35:06Z
updated: 2026-01-30T04:35:06Z
github: [Will be updated when synced to GitHub]
depends_on: [001]
parallel: true
conflicts_with: []
---

# Task: Build Layout Components (Modal, Tabs)

## Description

Create the more complex layout components (Modal/Dialog and Tabs) with proper keyboard accessibility, focus management, and ARIA attributes. These will replace shadcn/ui Dialog and Tabs components.

## Acceptance Criteria

- [x] Modal component with backdrop and close button
- [x] Modal has keyboard accessibility (ESC to close, focus trap)
- [x] Tabs component with underline style
- [x] Tabs keyboard accessible (Arrow keys, Tab, Home, End)
- [x] Both components use CSS Modules
- [x] ARIA attributes implemented correctly
- [x] Focus management working properly

## Technical Details

### 1. Modal Component

File: `frontend/src/components/ui/Modal/Modal.tsx`
```tsx
import { useEffect, useRef } from 'react'
import { createPortal } from 'react-dom'
import styles from './Modal.module.css'

interface ModalProps {
  isOpen: boolean
  onClose: () => void
  title?: string
  children: React.ReactNode
  size?: 'sm' | 'md' | 'lg' | 'xl'
}

export function Modal({ isOpen, onClose, title, children, size = 'md' }: ModalProps) {
  const modalRef = useRef<HTMLDivElement>(null)

  // Handle ESC key
  useEffect(() => {
    const handleEsc = (e: KeyboardEvent) => {
      if (e.key === 'Escape') onClose()
    }
    if (isOpen) {
      document.addEventListener('keydown', handleEsc)
      // Prevent body scroll
      document.body.style.overflow = 'hidden'
    }
    return () => {
      document.removeEventListener('keydown', handleEsc)
      document.body.style.overflow = ''
    }
  }, [isOpen, onClose])

  // Focus trap
  useEffect(() => {
    if (isOpen && modalRef.current) {
      const focusableElements = modalRef.current.querySelectorAll(
        'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
      )
      const firstElement = focusableElements[0] as HTMLElement
      const lastElement = focusableElements[focusableElements.length - 1] as HTMLElement

      const handleTab = (e: KeyboardEvent) => {
        if (e.key !== 'Tab') return
        if (e.shiftKey && document.activeElement === firstElement) {
          e.preventDefault()
          lastElement?.focus()
        } else if (!e.shiftKey && document.activeElement === lastElement) {
          e.preventDefault()
          firstElement?.focus()
        }
      }

      document.addEventListener('keydown', handleTab)
      firstElement?.focus()

      return () => document.removeEventListener('keydown', handleTab)
    }
  }, [isOpen])

  if (!isOpen) return null

  return createPortal(
    <div className={styles.backdrop} onClick={onClose}>
      <div
        ref={modalRef}
        className={`${styles.modal} ${styles[size]}`}
        onClick={(e) => e.stopPropagation()}
        role="dialog"
        aria-modal="true"
        aria-labelledby={title ? 'modal-title' : undefined}
      >
        {title && (
          <div className={styles.header}>
            <h2 id="modal-title" className={styles.title}>{title}</h2>
            <button
              className={styles.closeBtn}
              onClick={onClose}
              aria-label="Close modal"
            >
              ×
            </button>
          </div>
        )}
        <div className={styles.content}>{children}</div>
      </div>
    </div>,
    document.body
  )
}
```

File: `frontend/src/components/ui/Modal/Modal.module.css`
```css
.backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  animation: fadeIn var(--transition-fast);
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.modal {
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-lg);
  max-height: 85vh;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  animation: slideUp var(--transition-base);
}

@keyframes slideUp {
  from {
    transform: translateY(20px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.sm { width: 90%; max-width: 400px; }
.md { width: 90%; max-width: 600px; }
.lg { width: 90%; max-width: 800px; }
.xl { width: 90%; max-width: 1200px; }

.header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--space-xl);
  border-bottom: 1px solid var(--border);
}

.title {
  font-size: var(--text-lg);
  font-weight: 600;
  color: var(--text-primary);
}

.closeBtn {
  background: transparent;
  border: none;
  color: var(--text-secondary);
  font-size: 24px;
  cursor: pointer;
  padding: 0;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--radius-sm);
  transition: all var(--transition-fast);
}

.closeBtn:hover {
  background: var(--bg-hover);
  color: var(--text-primary);
}

.content {
  padding: var(--space-xl);
  overflow-y: auto;
  flex: 1;
}
```

### 2. Tabs Component

File: `frontend/src/components/ui/Tabs/Tabs.tsx`
```tsx
import { useState, useRef, useEffect } from 'react'
import styles from './Tabs.module.css'

interface Tab {
  id: string
  label: string
  content: React.ReactNode
}

interface TabsProps {
  tabs: Tab[]
  defaultTab?: string
  onChange?: (tabId: string) => void
}

export function Tabs({ tabs, defaultTab, onChange }: TabsProps) {
  const [activeTab, setActiveTab] = useState(defaultTab || tabs[0]?.id)
  const tabListRef = useRef<HTMLDivElement>(null)

  const handleTabChange = (tabId: string) => {
    setActiveTab(tabId)
    onChange?.(tabId)
  }

  // Keyboard navigation
  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      if (!tabListRef.current?.contains(document.activeElement)) return

      const currentIndex = tabs.findIndex(tab => tab.id === activeTab)
      let newIndex = currentIndex

      switch (e.key) {
        case 'ArrowRight':
          newIndex = (currentIndex + 1) % tabs.length
          break
        case 'ArrowLeft':
          newIndex = (currentIndex - 1 + tabs.length) % tabs.length
          break
        case 'Home':
          newIndex = 0
          break
        case 'End':
          newIndex = tabs.length - 1
          break
        default:
          return
      }

      e.preventDefault()
      handleTabChange(tabs[newIndex].id)
      const button = tabListRef.current?.querySelector(`[data-tab="${tabs[newIndex].id}"]`) as HTMLElement
      button?.focus()
    }

    document.addEventListener('keydown', handleKeyDown)
    return () => document.removeEventListener('keydown', handleKeyDown)
  }, [activeTab, tabs])

  return (
    <div className={styles.tabs}>
      <div className={styles.tabList} role="tablist" ref={tabListRef}>
        {tabs.map((tab) => (
          <button
            key={tab.id}
            data-tab={tab.id}
            className={`${styles.tab} ${activeTab === tab.id ? styles.active : ''}`}
            role="tab"
            aria-selected={activeTab === tab.id}
            aria-controls={`panel-${tab.id}`}
            id={`tab-${tab.id}`}
            tabIndex={activeTab === tab.id ? 0 : -1}
            onClick={() => handleTabChange(tab.id)}
          >
            {tab.label}
          </button>
        ))}
      </div>
      {tabs.map((tab) => (
        <div
          key={tab.id}
          id={`panel-${tab.id}`}
          role="tabpanel"
          aria-labelledby={`tab-${tab.id}`}
          hidden={activeTab !== tab.id}
          className={styles.tabPanel}
        >
          {activeTab === tab.id && tab.content}
        </div>
      ))}
    </div>
  )
}
```

File: `frontend/src/components/ui/Tabs/Tabs.module.css`
```css
.tabs {
  display: flex;
  flex-direction: column;
}

.tabList {
  display: flex;
  gap: var(--space-lg);
  border-bottom: 1px solid var(--border);
}

.tab {
  background: transparent;
  border: none;
  color: var(--text-secondary);
  font-family: var(--font-mono);
  font-size: var(--text-base);
  font-weight: 500;
  padding: var(--space-md) var(--space-sm);
  cursor: pointer;
  position: relative;
  transition: color var(--transition-fast);
  border-bottom: 2px solid transparent;
  margin-bottom: -1px;
}

.tab:hover {
  color: var(--text-primary);
}

.tab.active {
  color: var(--accent);
  border-bottom-color: var(--accent);
}

.tab:focus-visible {
  outline: 2px solid var(--border-focus);
  outline-offset: 2px;
}

.tabPanel {
  padding: var(--space-xl) 0;
}
```

### 3. Export

Update `frontend/src/components/ui/index.ts`:
```tsx
export { Modal } from './Modal/Modal'
export { Tabs } from './Tabs/Tabs'
```

## Implementation Steps

1. Create Modal component with focus trap logic
2. Create Tabs component with keyboard navigation
3. Test Modal: ESC key, backdrop click, focus management
4. Test Tabs: Arrow keys, Home/End, Tab key
5. Verify ARIA attributes with screen reader or axe DevTools
6. Test in different browsers

## Dependencies

- [x] Task 001 complete (design tokens)
- [ ] React Portal API (built-in)
- [ ] ARIA best practices documentation

## Effort Estimate

- **Size**: M
- **Hours**: 8-10 hours
- **Parallel**: ✅ Yes - Can run after Task 001

## Definition of Done

- [x] Modal component built with full keyboard support
- [x] Tabs component built with arrow key navigation
- [x] Focus trap working in Modal
- [x] ESC key closes Modal
- [x] ARIA attributes implemented
- [x] No accessibility violations (axe DevTools)
- [x] Components tested manually
- [x] Committed to version control
