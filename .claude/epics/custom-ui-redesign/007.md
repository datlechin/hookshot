---
name: Implement virtual scrolling for request list
status: open
created: 2026-01-30T04:35:06Z
updated: 2026-01-30T04:35:06Z
github: [Will be updated when synced to GitHub]
depends_on: [001, 006]
parallel: true
conflicts_with: []
---

# Task: Implement Virtual Scrolling for Request List

## Description

Implement virtual scrolling for the request list to handle 1000+ webhook requests efficiently. Only render visible rows (20-30 items) to reduce DOM nodes and improve performance.

## Acceptance Criteria

- [x] Virtual scrolling implemented for request list
- [x] Only visible rows rendered (~20-30 items)
- [x] Smooth scrolling performance (60fps)
- [x] List handles 1000+ requests without lag
- [x] Memory usage remains low (<50MB for 1000 items)
- [x] Auto-scroll to bottom for new requests (optional toggle)
- [x] Selected request remains in view when scrolling

## Technical Details

### Approach: Use `@tanstack/react-virtual`

**Install dependency:**
```bash
cd frontend
npm install @tanstack/react-virtual
```

**Alternative**: Build custom virtual scrolling (more complex, skip for MVP)

### Implementation

**File: `frontend/src/components/RequestList.tsx`**

```tsx
import { useVirtualizer } from '@tanstack/react-virtual'
import { useRef, useEffect } from 'react'

interface RequestListProps {
  requests: Request[]
  onSelectRequest: (request: Request) => void
  selectedId?: number
}

export function RequestList({ requests, onSelectRequest, selectedId }: RequestListProps) {
  const parentRef = useRef<HTMLDivElement>(null)

  const virtualizer = useVirtualizer({
    count: requests.length,
    getScrollElement: () => parentRef.current,
    estimateSize: () => 44, // Row height in pixels (compact)
    overscan: 5, // Render 5 extra items above/below viewport
  })

  // Auto-scroll to bottom when new requests arrive
  useEffect(() => {
    if (requests.length > 0) {
      virtualizer.scrollToIndex(requests.length - 1, {
        align: 'end',
        behavior: 'smooth',
      })
    }
  }, [requests.length])

  return (
    <div
      ref={parentRef}
      className="overflow-auto h-full"
      style={{ height: '600px' }} // Or use flex: 1 in parent
    >
      <div
        style={{
          height: `${virtualizer.getTotalSize()}px`,
          width: '100%',
          position: 'relative',
        }}
      >
        {virtualizer.getVirtualItems().map((virtualRow) => {
          const request = requests[virtualRow.index]
          return (
            <div
              key={request.id}
              data-index={virtualRow.index}
              ref={virtualizer.measureElement}
              style={{
                position: 'absolute',
                top: 0,
                left: 0,
                width: '100%',
                transform: `translateY(${virtualRow.start}px)`,
              }}
              className={`
                request-item
                ${selectedId === request.id ? 'selected' : ''}
              `}
              onClick={() => onSelectRequest(request)}
            >
              <RequestListItem request={request} />
            </div>
          )
        })}
      </div>
    </div>
  )
}
```

### RequestListItem Component

**File: `frontend/src/components/RequestListItem.tsx`**

```tsx
import { Badge } from '@/components/ui'
import type { Request } from '@/types'

interface RequestListItemProps {
  request: Request
}

export function RequestListItem({ request }: RequestListItemProps) {
  return (
    <div className="flex items-center gap-3 p-3 border-b border-[var(--border)] hover:bg-[var(--bg-hover)]">
      <Badge variant={getMethodVariant(request.method)}>
        {request.method}
      </Badge>
      <div className="flex-1 truncate font-mono text-sm">
        {request.path}
      </div>
      <div className="text-xs text-[var(--text-secondary)]">
        {new Date(request.received_at).toLocaleTimeString()}
      </div>
    </div>
  )
}

function getMethodVariant(method: string) {
  switch (method.toUpperCase()) {
    case 'GET': return 'success'
    case 'POST': return 'info'
    case 'PUT':
    case 'PATCH': return 'warning'
    case 'DELETE': return 'error'
    default: return 'default'
  }
}
```

### Styling

**File: `frontend/src/components/RequestList.module.css`**

```css
.requestList {
  height: 100%;
  overflow: auto;
  background: var(--bg-primary);
}

.virtualContainer {
  position: relative;
  width: 100%;
}

.requestItem {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 44px; /* Match estimateSize */
}

.requestItem.selected {
  background: var(--bg-hover);
  border-left: 2px solid var(--accent);
}
```

### Performance Considerations

1. **Row height consistency**: Use fixed height (44px) for predictable scrolling
2. **Overscan**: Render 5 extra rows above/below viewport to reduce flicker
3. **measureElement**: Let virtualizer measure dynamic heights if needed
4. **Memoization**: Wrap RequestListItem in React.memo to prevent unnecessary re-renders

### Testing Strategy

1. **Load test**: Create 1000 mock requests
2. **Scroll test**: Verify smooth 60fps scrolling
3. **Memory test**: Check memory usage in DevTools (should be <50MB)
4. **Auto-scroll test**: Add new request, verify scroll to bottom
5. **Selection test**: Select item, scroll, verify highlight persists

### Mock Data for Testing

```tsx
// Generate 1000 mock requests
const mockRequests = Array.from({ length: 1000 }, (_, i) => ({
  id: i + 1,
  method: ['GET', 'POST', 'PUT', 'DELETE'][Math.floor(Math.random() * 4)],
  path: `/api/webhook/${i}`,
  received_at: new Date(Date.now() - i * 1000).toISOString(),
  headers: {},
  body: null,
}))
```

## Implementation Steps

1. Install @tanstack/react-virtual
2. Create RequestListItem component
3. Update RequestList to use useVirtualizer
4. Test with 10 requests (basic functionality)
5. Test with 1000 requests (performance)
6. Measure scroll performance (Chrome DevTools FPS meter)
7. Implement auto-scroll to bottom
8. Add selected item highlighting
9. Verify memory usage

## Dependencies

- [x] Task 001 complete (design tokens)
- [x] Task 006 complete (Badge component)
- [ ] @tanstack/react-virtual library

## Effort Estimate

- **Size**: M
- **Hours**: 6-8 hours
- **Parallel**: âœ… Yes - Can run after Tasks 001 and 006

## Definition of Done

- [x] Virtual scrolling working with 1000+ items
- [x] Smooth 60fps scrolling
- [x] Memory usage <50MB for 1000 items
- [x] Auto-scroll to bottom for new requests
- [x] Selected item remains highlighted
- [x] No scroll flicker or jank
- [x] Performance validated with Chrome DevTools
- [x] Committed to version control
