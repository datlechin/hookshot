---
name: Request Detail Panel
status: open
created: 2026-01-30T08:03:38Z
updated: 2026-01-30T08:27:22Z
github: https://github.com/datlechin/hookshot/issues/30
depends_on: [26, 27]
parallel: true
conflicts_with: []
---

# Task: Request Detail Panel

## Description

Build a comprehensive request detail panel with tabbed interface (Overview, Headers, Body, Metadata), syntax highlighting, copy-to-clipboard functionality, and export options. This panel provides the core inspection capabilities for webhook debugging and analysis.

**Scope:**
- Implement tabbed interface with 4 tabs (Overview, Headers, Body, Metadata)
- Add syntax highlighting for JSON, XML, HTML, and other formats
- Implement copy-to-clipboard for headers and body
- Create export menu (JSON, cURL, HTTP raw format)
- Add collapsible sections and search within content
- Format large payloads efficiently (lazy rendering)

## Acceptance Criteria

- [ ] Tabs render correctly: Overview, Headers, Body, Metadata
- [ ] JSON body displays with syntax highlighting and collapsible tree
- [ ] XML/HTML body displays with syntax highlighting
- [ ] Plain text body displays with line numbers
- [ ] All headers display as key-value pairs with copy buttons
- [ ] Copy button works for individual headers and entire body
- [ ] Export dropdown with 3 options: JSON, cURL, HTTP raw
- [ ] Export to JSON downloads complete request as .json file
- [ ] Export to cURL generates valid curl command
- [ ] Export to HTTP raw shows raw HTTP request format
- [ ] Search/filter works within headers
- [ ] Large bodies (>100KB) render without freezing UI
- [ ] Panel is closable via X button or ESC key

## Technical Details

### Component Structure

1. **DetailPanel Component** (`components/detail/DetailPanel.tsx`)
   ```typescript
   interface DetailPanelProps {
     request: Request | null;
     onClose: () => void;
   }

   export function DetailPanel({ request, onClose }: DetailPanelProps) {
     const [activeTab, setActiveTab] = useState<'overview' | 'headers' | 'body' | 'metadata'>('overview');

     if (!request) {
       return <EmptyState message="Select a request to view details" />;
     }

     return (
       <div className="h-full flex flex-col bg-surface border-l border-border">
         <DetailHeader request={request} onClose={onClose} />
         <Tabs value={activeTab} onValueChange={setActiveTab}>
           <TabsList>
             <TabsTrigger value="overview">Overview</TabsTrigger>
             <TabsTrigger value="headers">Headers</TabsTrigger>
             <TabsTrigger value="body">Body</TabsTrigger>
             <TabsTrigger value="metadata">Metadata</TabsTrigger>
           </TabsList>
           <TabsContent value="overview">
             <OverviewTab request={request} />
           </TabsContent>
           <TabsContent value="headers">
             <HeadersTab headers={request.headers} />
           </TabsContent>
           <TabsContent value="body">
             <BodyTab body={request.body} contentType={request.content_type} />
           </TabsContent>
           <TabsContent value="metadata">
             <MetadataTab request={request} />
           </TabsContent>
         </Tabs>
       </div>
     );
   }
   ```

2. **DetailHeader** (`components/detail/DetailHeader.tsx`)
   - Request method badge (color-coded: GET=blue, POST=green, DELETE=red)
   - Request ID and timestamp
   - Export dropdown button
   - Close button (X)
   - Copy full request button

3. **OverviewTab** (`components/detail/OverviewTab.tsx`)
   - Method, path, query string
   - IP address and timestamp
   - Content-Type and size
   - Quick preview of body (first 200 chars)
   - Quick action buttons (Copy cURL, Export JSON)

4. **HeadersTab** (`components/detail/HeadersTab.tsx`)
   ```typescript
   function HeadersTab({ headers }: { headers: Record<string, string> }) {
     const [filter, setFilter] = useState('');
     const filteredHeaders = Object.entries(headers).filter(([key]) =>
       key.toLowerCase().includes(filter.toLowerCase())
     );

     return (
       <div className="p-4">
         <Input
           placeholder="Filter headers..."
           value={filter}
           onChange={(e) => setFilter(e.target.value)}
           className="mb-4"
         />
         <div className="space-y-2">
           {filteredHeaders.map(([key, value]) => (
             <HeaderRow key={key} name={key} value={value} />
           ))}
         </div>
       </div>
     );
   }
   ```

5. **BodyTab** (`components/detail/BodyTab.tsx`)
   - Detect content type (JSON, XML, HTML, plain text)
   - Render with appropriate formatter
   - Syntax highlighting for code formats
   - Line numbers for text
   - Collapsible tree for JSON
   - Copy button for entire body
   - Search within body

6. **MetadataTab** (`components/detail/MetadataTab.tsx`)
   - Request ID
   - Endpoint ID
   - Received timestamp (formatted)
   - IP address and geolocation (if available)
   - Size (headers + body)
   - Processing time (if tracked)

### Syntax Highlighting

Install and configure Prism.js or react-syntax-highlighter:

```bash
npm install react-syntax-highlighter
npm install @types/react-syntax-highlighter -D
```

**BodyTab with Syntax Highlighting:**
```typescript
import { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';
import { oneDark } from 'react-syntax-highlighter/dist/esm/styles/prism';

function BodyTab({ body, contentType }: { body?: string; contentType?: string }) {
  if (!body) {
    return <EmptyState message="No body content" />;
  }

  const language = getLanguageFromContentType(contentType);
  const formattedBody = formatBody(body, language);

  return (
    <div className="p-4">
      <div className="flex justify-between mb-2">
        <span className="text-sm text-text-secondary">
          {body.length} bytes
        </span>
        <CopyButton text={body} />
      </div>
      <SyntaxHighlighter
        language={language}
        style={oneDark}
        showLineNumbers
        wrapLines
      >
        {formattedBody}
      </SyntaxHighlighter>
    </div>
  );
}

function getLanguageFromContentType(contentType?: string): string {
  if (!contentType) return 'text';
  if (contentType.includes('json')) return 'json';
  if (contentType.includes('xml')) return 'xml';
  if (contentType.includes('html')) return 'html';
  if (contentType.includes('javascript')) return 'javascript';
  return 'text';
}

function formatBody(body: string, language: string): string {
  if (language === 'json') {
    try {
      return JSON.stringify(JSON.parse(body), null, 2);
    } catch {
      return body;
    }
  }
  return body;
}
```

### Copy to Clipboard

Create reusable CopyButton component:

```typescript
function CopyButton({ text, label = 'Copy' }: { text: string; label?: string }) {
  const [copied, setCopied] = useState(false);

  const handleCopy = async () => {
    await navigator.clipboard.writeText(text);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000);
  };

  return (
    <Button
      variant="ghost"
      size="sm"
      onClick={handleCopy}
      className="gap-2"
    >
      {copied ? <Check className="w-4 h-4" /> : <Copy className="w-4 h-4" />}
      {copied ? 'Copied!' : label}
    </Button>
  );
}
```

### Export Functionality

**Export Utilities** (`lib/export.ts`):

```typescript
export function exportAsJSON(request: Request) {
  const json = JSON.stringify(request, null, 2);
  const blob = new Blob([json], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `request-${request.id}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

export function exportAsCurl(request: Request): string {
  const headers = Object.entries(request.headers)
    .map(([key, value]) => `-H "${key}: ${value}"`)
    .join(' \\\n  ');

  const body = request.body
    ? `-d '${request.body.replace(/'/g, "\\'")}'`
    : '';

  const url = `${location.origin}${request.path}${request.query_string ? '?' + request.query_string : ''}`;

  return `curl -X ${request.method} \\\n  ${headers} \\\n  ${body} \\\n  "${url}"`;
}

export function exportAsHTTPRaw(request: Request): string {
  const queryString = request.query_string ? `?${request.query_string}` : '';
  const headers = Object.entries(request.headers)
    .map(([key, value]) => `${key}: ${value}`)
    .join('\n');

  return `${request.method} ${request.path}${queryString} HTTP/1.1\n${headers}\n\n${request.body || ''}`;
}
```

**ExportDropdown Component:**
```typescript
function ExportDropdown({ request }: { request: Request }) {
  const handleExport = (format: 'json' | 'curl' | 'http') => {
    switch (format) {
      case 'json':
        exportAsJSON(request);
        break;
      case 'curl':
        const curlCommand = exportAsCurl(request);
        navigator.clipboard.writeText(curlCommand);
        toast.success('cURL command copied to clipboard');
        break;
      case 'http':
        const httpRaw = exportAsHTTPRaw(request);
        navigator.clipboard.writeText(httpRaw);
        toast.success('HTTP raw format copied to clipboard');
        break;
    }
  };

  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <Button variant="outline" size="sm">
          <Download className="w-4 h-4 mr-2" />
          Export
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent>
        <DropdownMenuItem onClick={() => handleExport('json')}>
          Export as JSON
        </DropdownMenuItem>
        <DropdownMenuItem onClick={() => handleExport('curl')}>
          Copy as cURL
        </DropdownMenuItem>
        <DropdownMenuItem onClick={() => handleExport('http')}>
          Copy as HTTP Raw
        </DropdownMenuItem>
      </DropdownMenuContent>
    </DropdownMenu>
  );
}
```

### Performance: Large Payloads

For bodies >100KB, implement virtualization or lazy rendering:

```typescript
function BodyTab({ body }: { body?: string }) {
  const isLarge = body && body.length > 100000;

  if (isLarge) {
    return (
      <div className="p-4">
        <Alert variant="warning" className="mb-4">
          Large payload detected ({(body.length / 1024).toFixed(1)}KB).
          Rendering may be slow.
        </Alert>
        <Collapsible>
          <CollapsibleTrigger>Show content</CollapsibleTrigger>
          <CollapsibleContent>
            <SyntaxHighlighter {...props}>
              {body}
            </SyntaxHighlighter>
          </CollapsibleContent>
        </Collapsible>
      </div>
    );
  }

  // Normal rendering for small payloads
  return <SyntaxHighlighter {...props}>{body}</SyntaxHighlighter>;
}
```

## Dependencies

### Blocking Dependencies
- [ ] Task 002: Core Layout & Theming (for panel structure)
- [ ] Task 003: API Client & Type Definitions (for Request type)

### External Dependencies
- [ ] react-syntax-highlighter for code highlighting
  ```bash
  npm install react-syntax-highlighter
  npm install @types/react-syntax-highlighter -D
  ```
- [ ] lucide-react for icons (Copy, Download, Check, X)

## Effort Estimate

- **Size:** Large (L)
- **Hours:** 10-12 hours
- **Parallel:** true (can work alongside Task 004 and 005)

**Breakdown:**
- DetailPanel structure: 1 hour
- OverviewTab: 1 hour
- HeadersTab with filtering: 1.5 hours
- BodyTab with syntax highlighting: 2.5 hours
- MetadataTab: 1 hour
- Copy functionality: 1 hour
- Export utilities (JSON, cURL, HTTP): 2 hours
- Large payload handling: 1 hour
- Testing and refinement: 2 hours

## Definition of Done

- [ ] All 4 tabs render correctly and switch smoothly
- [ ] JSON body displays with proper formatting and highlighting
- [ ] Copy buttons work for headers and body
- [ ] Export to JSON downloads valid JSON file
- [ ] cURL export generates working curl command
- [ ] HTTP raw export shows correct format
- [ ] Search/filter in headers works
- [ ] Large payloads (>100KB) render without UI freeze
- [ ] Panel closes via X button and ESC key
- [ ] Code is TypeScript strict mode compliant
- [ ] No console errors or warnings

## Notes

- Consider using @uiw/react-json-view for collapsible JSON tree view
- Add keyboard shortcuts: ESC to close, Ctrl+C to copy
- Consider adding "Pretty print" toggle for JSON/XML
- Add tooltips for truncated header values
- Test with various content types: JSON, XML, HTML, form-data, binary
- Consider adding hex dump view for binary data
- Add line wrapping toggle for long lines

## References

- react-syntax-highlighter: https://github.com/react-syntax-highlighter/react-syntax-highlighter
- Clipboard API: https://developer.mozilla.org/en-US/docs/Web/API/Clipboard
- shadcn/ui Tabs: https://ui.shadcn.com/docs/components/tabs
