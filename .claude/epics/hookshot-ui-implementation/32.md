---
name: Custom Response Configuration
status: completed
created: 2026-01-30T08:03:38Z
updated: 2026-01-30T09:17:22Z
github: https://github.com/datlechin/hookshot/issues/32
depends_on: [27, 28]
parallel: true
conflicts_with: []
---

# Task: Custom Response Configuration

## Description

Implement the endpoint configuration panel that allows users to customize webhook responses (status code, headers, body). This enables testing how external systems handle different response scenarios without requiring backend code changes.

**Scope:**
- Create endpoint configuration panel/modal
- Implement custom response toggle (enable/disable)
- Add form inputs for status code, headers, and body
- Validate inputs (status code range, header format, JSON syntax)
- Save configuration to backend via API
- Display current configuration in endpoint sidebar
- Show visual indicator when custom response is enabled

## Acceptance Criteria

- [ ] Configuration panel opens when clicking endpoint settings icon
- [ ] Custom response toggle works (enable/disable)
- [ ] Status code input accepts 100-599 with validation
- [ ] Status code dropdown shows common codes (200, 201, 400, 404, 500)
- [ ] Headers editor allows adding/removing key-value pairs
- [ ] Body editor has syntax highlighting for JSON
- [ ] Body editor validates JSON syntax (if content-type is JSON)
- [ ] Save button calls backend API with configuration
- [ ] Cancel button reverts changes without saving
- [ ] Configuration persists after page reload
- [ ] Endpoint sidebar shows badge when custom response is enabled
- [ ] Validation errors display with helpful messages

## Technical Details

### 1. Endpoint Configuration Modal (`components/endpoint/ConfigModal.tsx`)

```typescript
interface ConfigModalProps {
  endpoint: Endpoint;
  open: boolean;
  onClose: () => void;
  onSave: (config: EndpointConfig) => void;
}

export function ConfigModal({ endpoint, open, onClose, onSave }: ConfigModalProps) {
  const [enabled, setEnabled] = useState(endpoint.custom_response_enabled);
  const [status, setStatus] = useState(endpoint.response_status || 200);
  const [headers, setHeaders] = useState<Record<string, string>>(
    endpoint.response_headers || {}
  );
  const [body, setBody] = useState(endpoint.response_body || '');
  const [errors, setErrors] = useState<Record<string, string>>({});

  const validate = (): boolean => {
    const newErrors: Record<string, string> = {};

    // Validate status code
    if (status < 100 || status > 599) {
      newErrors.status = 'Status code must be between 100 and 599';
    }

    // Validate headers
    for (const [key, value] of Object.entries(headers)) {
      if (!key.trim()) {
        newErrors.headers = 'Header names cannot be empty';
        break;
      }
    }

    // Validate JSON body if content-type is JSON
    const contentType = headers['Content-Type'] || headers['content-type'];
    if (contentType?.includes('json') && body) {
      try {
        JSON.parse(body);
      } catch (err) {
        newErrors.body = 'Invalid JSON syntax';
      }
    }

    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSave = async () => {
    if (!validate()) return;

    const config: EndpointConfig = {
      custom_response_enabled: enabled,
      response_status: enabled ? status : undefined,
      response_headers: enabled ? headers : undefined,
      response_body: enabled ? body : undefined,
    };

    await onSave(config);
    onClose();
  };

  return (
    <Dialog open={open} onOpenChange={onClose}>
      <DialogContent className="max-w-2xl max-h-[80vh] overflow-y-auto">
        <DialogHeader>
          <DialogTitle>Configure Endpoint Response</DialogTitle>
          <DialogDescription>
            Customize the HTTP response for incoming webhooks to this endpoint.
          </DialogDescription>
        </DialogHeader>

        <div className="space-y-6 py-4">
          {/* Enable/Disable Toggle */}
          <div className="flex items-center justify-between">
            <Label htmlFor="enabled" className="text-base">
              Custom Response
            </Label>
            <Switch
              id="enabled"
              checked={enabled}
              onCheckedChange={setEnabled}
            />
          </div>

          {enabled && (
            <>
              {/* Status Code */}
              <div className="space-y-2">
                <Label htmlFor="status">Status Code</Label>
                <div className="flex gap-2">
                  <Input
                    id="status"
                    type="number"
                    min={100}
                    max={599}
                    value={status}
                    onChange={(e) => setStatus(Number(e.target.value))}
                    className="w-32"
                  />
                  <Select value={String(status)} onValueChange={(v) => setStatus(Number(v))}>
                    <SelectTrigger className="w-48">
                      <SelectValue />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="200">200 OK</SelectItem>
                      <SelectItem value="201">201 Created</SelectItem>
                      <SelectItem value="204">204 No Content</SelectItem>
                      <SelectItem value="400">400 Bad Request</SelectItem>
                      <SelectItem value="401">401 Unauthorized</SelectItem>
                      <SelectItem value="404">404 Not Found</SelectItem>
                      <SelectItem value="500">500 Internal Server Error</SelectItem>
                      <SelectItem value="503">503 Service Unavailable</SelectItem>
                    </SelectContent>
                  </Select>
                </div>
                {errors.status && (
                  <p className="text-sm text-red-500">{errors.status}</p>
                )}
              </div>

              {/* Headers */}
              <div className="space-y-2">
                <Label>Response Headers</Label>
                <HeadersEditor
                  headers={headers}
                  onChange={setHeaders}
                  error={errors.headers}
                />
              </div>

              {/* Body */}
              <div className="space-y-2">
                <Label htmlFor="body">Response Body</Label>
                <BodyEditor
                  value={body}
                  onChange={setBody}
                  contentType={headers['Content-Type']}
                  error={errors.body}
                />
              </div>
            </>
          )}
        </div>

        <DialogFooter>
          <Button variant="outline" onClick={onClose}>
            Cancel
          </Button>
          <Button onClick={handleSave} disabled={Object.keys(errors).length > 0}>
            Save Configuration
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}
```

### 2. Headers Editor (`components/endpoint/HeadersEditor.tsx`)

```typescript
interface HeadersEditorProps {
  headers: Record<string, string>;
  onChange: (headers: Record<string, string>) => void;
  error?: string;
}

export function HeadersEditor({ headers, onChange, error }: HeadersEditorProps) {
  const [entries, setEntries] = useState<Array<{ key: string; value: string }>>(
    Object.entries(headers).map(([key, value]) => ({ key, value }))
  );

  const handleAdd = () => {
    setEntries([...entries, { key: '', value: '' }]);
  };

  const handleRemove = (index: number) => {
    const newEntries = entries.filter((_, i) => i !== index);
    setEntries(newEntries);
    updateHeaders(newEntries);
  };

  const handleChange = (index: number, field: 'key' | 'value', value: string) => {
    const newEntries = [...entries];
    newEntries[index][field] = value;
    setEntries(newEntries);
    updateHeaders(newEntries);
  };

  const updateHeaders = (entries: Array<{ key: string; value: string }>) => {
    const newHeaders: Record<string, string> = {};
    entries.forEach(({ key, value }) => {
      if (key.trim()) {
        newHeaders[key] = value;
      }
    });
    onChange(newHeaders);
  };

  return (
    <div className="space-y-2">
      {entries.map((entry, index) => (
        <div key={index} className="flex gap-2">
          <Input
            placeholder="Header name"
            value={entry.key}
            onChange={(e) => handleChange(index, 'key', e.target.value)}
            className="flex-1"
          />
          <Input
            placeholder="Header value"
            value={entry.value}
            onChange={(e) => handleChange(index, 'value', e.target.value)}
            className="flex-1"
          />
          <Button
            variant="ghost"
            size="icon"
            onClick={() => handleRemove(index)}
          >
            <X className="w-4 h-4" />
          </Button>
        </div>
      ))}
      <Button variant="outline" size="sm" onClick={handleAdd} className="w-full">
        <Plus className="w-4 h-4 mr-2" />
        Add Header
      </Button>
      {error && <p className="text-sm text-red-500">{error}</p>}
    </div>
  );
}
```

### 3. Body Editor (`components/endpoint/BodyEditor.tsx`)

```typescript
interface BodyEditorProps {
  value: string;
  onChange: (value: string) => void;
  contentType?: string;
  error?: string;
}

export function BodyEditor({ value, onChange, contentType, error }: BodyEditorProps) {
  const [mode, setMode] = useState<'text' | 'json'>('text');

  useEffect(() => {
    if (contentType?.includes('json')) {
      setMode('json');
    }
  }, [contentType]);

  const handleFormat = () => {
    if (mode === 'json') {
      try {
        const formatted = JSON.stringify(JSON.parse(value), null, 2);
        onChange(formatted);
      } catch (err) {
        // Invalid JSON, don't format
      }
    }
  };

  return (
    <div className="space-y-2">
      <div className="flex justify-between items-center">
        <div className="flex gap-2">
          <Button
            variant={mode === 'text' ? 'default' : 'outline'}
            size="sm"
            onClick={() => setMode('text')}
          >
            Text
          </Button>
          <Button
            variant={mode === 'json' ? 'default' : 'outline'}
            size="sm"
            onClick={() => setMode('json')}
          >
            JSON
          </Button>
        </div>
        {mode === 'json' && (
          <Button variant="outline" size="sm" onClick={handleFormat}>
            Format
          </Button>
        )}
      </div>

      <Textarea
        id="body"
        value={value}
        onChange={(e) => onChange(e.target.value)}
        placeholder={mode === 'json' ? '{"message": "Success"}' : 'Response body...'}
        rows={10}
        className={cn(
          'font-mono text-sm',
          error && 'border-red-500'
        )}
      />

      {error && <p className="text-sm text-red-500">{error}</p>}

      <p className="text-xs text-text-secondary">
        {value.length} characters
      </p>
    </div>
  );
}
```

### 4. Integration with Endpoint Sidebar (`components/endpoint/EndpointItem.tsx`)

```typescript
interface EndpointItemProps {
  endpoint: Endpoint;
  active?: boolean;
  onClick?: () => void;
}

export function EndpointItem({ endpoint, active, onClick }: EndpointItemProps) {
  const [configOpen, setConfigOpen] = useState(false);

  const handleConfigSave = async (config: EndpointConfig) => {
    await api.endpoints.updateConfig(endpoint.id, config);
    // Refresh endpoint list
  };

  return (
    <>
      <div
        className={cn(
          'flex items-center gap-2 p-3 rounded-lg cursor-pointer transition-colors',
          'hover:bg-surface-hover',
          active && 'bg-surface-hover'
        )}
        onClick={onClick}
      >
        <div className="flex-1 min-w-0">
          <div className="flex items-center gap-2">
            <code className="text-sm font-mono text-text-primary truncate">
              /{endpoint.id}
            </code>
            {endpoint.custom_response_enabled && (
              <Badge variant="secondary" className="text-xs">
                Custom
              </Badge>
            )}
          </div>
          <div className="text-xs text-text-secondary">
            {formatDistanceToNow(new Date(endpoint.created_at), { addSuffix: true })}
          </div>
        </div>

        <Button
          variant="ghost"
          size="icon"
          onClick={(e) => {
            e.stopPropagation();
            setConfigOpen(true);
          }}
        >
          <Settings className="w-4 h-4" />
        </Button>
      </div>

      <ConfigModal
        endpoint={endpoint}
        open={configOpen}
        onClose={() => setConfigOpen(false)}
        onSave={handleConfigSave}
      />
    </>
  );
}
```

### 5. Common Status Code Presets

Create utility for status code descriptions:

```typescript
export const STATUS_CODES = {
  200: 'OK',
  201: 'Created',
  204: 'No Content',
  400: 'Bad Request',
  401: 'Unauthorized',
  403: 'Forbidden',
  404: 'Not Found',
  405: 'Method Not Allowed',
  429: 'Too Many Requests',
  500: 'Internal Server Error',
  502: 'Bad Gateway',
  503: 'Service Unavailable',
  504: 'Gateway Timeout',
} as const;

export function getStatusDescription(code: number): string {
  return STATUS_CODES[code as keyof typeof STATUS_CODES] || 'Unknown';
}
```

## Dependencies

### Blocking Dependencies
- [ ] Task 003: API Client & Type Definitions (for API integration)
- [ ] Task 004: Endpoint Sidebar (for integration)

### External Dependencies
- [ ] shadcn/ui components: Dialog, Switch, Select, Textarea
  ```bash
  npx shadcn-ui@latest add dialog switch select textarea
  ```
- [ ] lucide-react for icons (Settings, Plus, X)

## Effort Estimate

- **Size:** Medium (M)
- **Hours:** 6-8 hours
- **Parallel:** true (can work alongside other tasks)

**Breakdown:**
- ConfigModal structure: 1.5 hours
- HeadersEditor component: 1.5 hours
- BodyEditor component: 1.5 hours
- Validation logic: 1 hour
- API integration: 1 hour
- Endpoint sidebar integration: 0.5 hours
- Testing and edge cases: 1.5 hours

## Definition of Done

- [ ] Configuration modal opens and closes correctly
- [ ] Custom response toggle enables/disables all fields
- [ ] Status code validation works (100-599 range)
- [ ] Headers can be added, edited, and removed
- [ ] Body editor validates JSON when content-type is JSON
- [ ] Save button calls API and persists configuration
- [ ] Configuration persists after page reload
- [ ] Endpoint sidebar shows "Custom" badge when enabled
- [ ] All validation errors display helpful messages
- [ ] Code is TypeScript strict mode compliant
- [ ] No console errors or warnings

## Notes

- Consider adding response preview (how the response will look)
- Add templates for common responses (Success, Error, Empty)
- Consider adding delay option (simulate slow responses)
- Add validation for header names (no spaces, valid characters)
- Test with various status codes (2xx, 4xx, 5xx)
- Consider adding Content-Type auto-detection from body
- Add keyboard shortcuts: Ctrl+S to save, ESC to cancel

## References

- HTTP Status Codes: https://developer.mozilla.org/en-US/docs/Web/HTTP/Status
- shadcn/ui Dialog: https://ui.shadcn.com/docs/components/dialog
- HTTP Headers: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers
