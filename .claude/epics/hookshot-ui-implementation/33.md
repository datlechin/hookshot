---
name: Performance Optimization & Polish
status: in-progress
created: 2026-01-30T08:03:38Z
updated: 2026-01-31T08:21:52Z
github: https://github.com/datlechin/hookshot/issues/33
depends_on: [28, 29, 30, 31, 32]
parallel: false
conflicts_with: []
---

# Task: Performance Optimization & Polish

## Description

Optimize bundle size, improve loading performance, enhance user experience with loading states, animations, and error handling. This task takes the functional UI and makes it production-ready with excellent performance, accessibility, and user experience.

**Scope:**
- Bundle size optimization (code splitting, lazy loading, tree shaking)
- Implement loading states for all async operations
- Add skeleton loaders and empty states
- Implement error boundaries and error handling UI
- Add form validation and user feedback
- Implement smooth animations and transitions
- Cross-browser testing and fixes
- Performance audits and optimizations

## Acceptance Criteria

- [ ] Bundle size <300KB gzipped (excluding vendor chunks)
- [ ] First Contentful Paint (FCP) <1.5s on 3G network
- [ ] Lighthouse Performance score >90
- [ ] All routes lazy-loaded with React.lazy
- [ ] Loading states display for API calls >500ms
- [ ] Skeleton loaders shown while fetching data
- [ ] Error boundaries catch and display component errors
- [ ] 404 page for invalid routes
- [ ] Form validation shows inline errors
- [ ] Toast notifications for success/error actions
- [ ] Smooth transitions between panels (no janky animations)
- [ ] Works correctly in Chrome, Firefox, Safari, Edge
- [ ] No console errors or warnings in production build

## Technical Details

### 1. Code Splitting & Lazy Loading

Implement route-based code splitting:

```typescript
// App.tsx
import { lazy, Suspense } from 'react';
import { BrowserRouter, Routes, Route } from 'react-router-dom';

// Lazy load pages
const MainView = lazy(() => import('./pages/MainView'));
const NotFound = lazy(() => import('./pages/NotFound'));

function App() {
  return (
    <BrowserRouter>
      <Suspense fallback={<LoadingFallback />}>
        <Routes>
          <Route path="/" element={<MainView />} />
          <Route path="*" element={<NotFound />} />
        </Routes>
      </Suspense>
    </BrowserRouter>
  );
}
```

Lazy load heavy components:

```typescript
// Lazy load syntax highlighter (heavy dependency)
const SyntaxHighlighter = lazy(() =>
  import('react-syntax-highlighter').then((mod) => ({
    default: mod.Prism,
  }))
);

// Lazy load large modals
const ConfigModal = lazy(() => import('./components/endpoint/ConfigModal'));
```

### 2. Bundle Size Optimization

**Vite Configuration** (`vite.config.ts`):

```typescript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';
import { visualizer } from 'rollup-plugin-visualizer';

export default defineConfig({
  plugins: [
    react(),
    visualizer({ open: true, gzipSize: true }),
  ],
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'vendor-react': ['react', 'react-dom'],
          'vendor-ui': ['@radix-ui/react-dialog', '@radix-ui/react-tabs'],
          'vendor-utils': ['date-fns', 'clsx'],
        },
      },
    },
    chunkSizeWarningLimit: 600,
  },
});
```

**Tree Shaking Improvements:**

```typescript
// Bad - imports entire library
import _ from 'lodash';

// Good - imports only what's needed
import { debounce } from 'lodash-es';

// Better - use native alternatives
const debounce = (fn, delay) => {
  let timeoutId;
  return (...args) => {
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => fn(...args), delay);
  };
};
```

### 3. Loading States

**Global Loading Component** (`components/ui/Loading.tsx`):

```typescript
export function LoadingFallback() {
  return (
    <div className="flex items-center justify-center h-screen">
      <div className="flex flex-col items-center gap-4">
        <Loader className="w-8 h-8 animate-spin text-accent-blue" />
        <p className="text-sm text-text-secondary">Loading...</p>
      </div>
    </div>
  );
}

export function LoadingSpinner({ size = 'md' }: { size?: 'sm' | 'md' | 'lg' }) {
  const sizeClasses = {
    sm: 'w-4 h-4',
    md: 'w-6 h-6',
    lg: 'w-8 h-8',
  };

  return (
    <Loader className={`animate-spin text-accent-blue ${sizeClasses[size]}`} />
  );
}
```

**Skeleton Loaders** (`components/ui/Skeleton.tsx`):

```typescript
export function RequestListSkeleton() {
  return (
    <div className="space-y-2 p-4">
      {Array.from({ length: 5 }).map((_, i) => (
        <div key={i} className="flex items-center gap-3 p-4 animate-pulse">
          <div className="w-16 h-6 bg-surface-hover rounded" />
          <div className="flex-1 space-y-2">
            <div className="w-3/4 h-4 bg-surface-hover rounded" />
            <div className="w-1/2 h-3 bg-surface-hover rounded" />
          </div>
        </div>
      ))}
    </div>
  );
}

export function DetailPanelSkeleton() {
  return (
    <div className="p-4 space-y-4 animate-pulse">
      <div className="w-1/3 h-6 bg-surface-hover rounded" />
      <div className="space-y-2">
        {Array.from({ length: 8 }).map((_, i) => (
          <div key={i} className="w-full h-4 bg-surface-hover rounded" />
        ))}
      </div>
    </div>
  );
}
```

### 4. Error Boundaries

**Error Boundary Component** (`components/ErrorBoundary.tsx`):

```typescript
import { Component, ReactNode } from 'react';

interface Props {
  children: ReactNode;
  fallback?: ReactNode;
}

interface State {
  hasError: boolean;
  error?: Error;
}

export class ErrorBoundary extends Component<Props, State> {
  constructor(props: Props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error: Error): State {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: any) {
    console.error('Error caught by boundary:', error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return this.props.fallback || (
        <div className="flex items-center justify-center h-screen">
          <div className="max-w-md p-6 bg-surface rounded-lg border border-border">
            <AlertCircle className="w-12 h-12 text-red-500 mb-4" />
            <h2 className="text-xl font-semibold mb-2">Something went wrong</h2>
            <p className="text-text-secondary mb-4">
              {this.state.error?.message || 'An unexpected error occurred'}
            </p>
            <Button onClick={() => window.location.reload()}>
              Reload Page
            </Button>
          </div>
        </div>
      );
    }

    return this.props.children;
  }
}
```

**Usage:**

```typescript
function App() {
  return (
    <ErrorBoundary>
      <MainView />
    </ErrorBoundary>
  );
}
```

### 5. Toast Notifications

Install and configure toast library:

```bash
npx shadcn-ui@latest add toast
```

**Toast Hook** (`hooks/useToast.ts`):

```typescript
import { useToast as useToastBase } from '@/components/ui/use-toast';

export function useToast() {
  const { toast } = useToastBase();

  return {
    success: (message: string) => {
      toast({
        title: 'Success',
        description: message,
        variant: 'default',
      });
    },
    error: (message: string) => {
      toast({
        title: 'Error',
        description: message,
        variant: 'destructive',
      });
    },
    info: (message: string) => {
      toast({
        title: 'Info',
        description: message,
        variant: 'default',
      });
    },
  };
}
```

**Usage in Components:**

```typescript
function EndpointSidebar() {
  const { success, error } = useToast();

  const handleCreateEndpoint = async () => {
    try {
      await api.endpoints.create();
      success('Endpoint created successfully');
    } catch (err) {
      error('Failed to create endpoint');
    }
  };

  return <Button onClick={handleCreateEndpoint}>Create Endpoint</Button>;
}
```

### 6. Form Validation

**Validation Utilities** (`lib/validation.ts`):

```typescript
export function validateStatusCode(code: number): string | null {
  if (code < 100 || code > 599) {
    return 'Status code must be between 100 and 599';
  }
  return null;
}

export function validateJSON(value: string): string | null {
  if (!value.trim()) return null;
  try {
    JSON.parse(value);
    return null;
  } catch (err) {
    return 'Invalid JSON syntax';
  }
}

export function validateHeaderName(name: string): string | null {
  if (!name.trim()) {
    return 'Header name cannot be empty';
  }
  if (!/^[a-zA-Z0-9-]+$/.test(name)) {
    return 'Header name can only contain letters, numbers, and hyphens';
  }
  return null;
}
```

### 7. Animations & Transitions

**Transition Utilities** (`lib/transitions.ts`):

```typescript
export const transitions = {
  fast: 'transition-all duration-150 ease-in-out',
  normal: 'transition-all duration-200 ease-in-out',
  slow: 'transition-all duration-300 ease-in-out',
};

export const animations = {
  fadeIn: 'animate-in fade-in duration-200',
  slideIn: 'animate-in slide-in-from-right duration-300',
  pulse: 'animate-pulse',
};
```

**CSS Animations** (add to `index.css`):

```css
@keyframes fade-in {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes slide-in-from-right {
  from {
    transform: translateX(100%);
  }
  to {
    transform: translateX(0);
  }
}

.animate-in {
  animation-fill-mode: both;
}

.fade-in {
  animation-name: fade-in;
}

.slide-in-from-right {
  animation-name: slide-in-from-right;
}
```

### 8. Performance Monitoring

**Add Performance Logging:**

```typescript
// lib/performance.ts
export function measurePerformance(name: string, fn: () => void) {
  const start = performance.now();
  fn();
  const end = performance.now();
  console.log(`[Performance] ${name}: ${(end - start).toFixed(2)}ms`);
}

// Usage
useEffect(() => {
  measurePerformance('Fetch endpoints', async () => {
    await api.endpoints.list();
  });
}, []);
```

### 9. Cross-Browser Testing Checklist

- [ ] Chrome (latest)
- [ ] Firefox (latest)
- [ ] Safari (latest, macOS and iOS)
- [ ] Edge (latest)
- [ ] Mobile Safari (iOS)
- [ ] Chrome Mobile (Android)

Test these features across browsers:
- WebSocket connections
- Clipboard API (copy functionality)
- CSS Grid/Flexbox layouts
- Dark mode
- Local storage persistence

### 10. Production Build Optimizations

**Environment Variables** (`.env.production`):

```
VITE_API_URL=
VITE_WS_URL=
```

**Build Command:**

```json
{
  "scripts": {
    "build": "tsc && vite build",
    "build:analyze": "tsc && vite build --mode analyze",
    "preview": "vite preview"
  }
}
```

## Dependencies

### Blocking Dependencies
- [ ] Task 004: Endpoint Sidebar
- [ ] Task 005: Request List
- [ ] Task 006: Request Detail Panel
- [ ] Task 007: Real-time Updates
- [ ] Task 008: Custom Response Configuration

### External Dependencies
- [ ] rollup-plugin-visualizer for bundle analysis
  ```bash
  npm install -D rollup-plugin-visualizer
  ```
- [ ] shadcn/ui toast component
  ```bash
  npx shadcn-ui@latest add toast
  ```

## Effort Estimate

- **Size:** Medium (M)
- **Hours:** 8-10 hours
- **Parallel:** false (depends on all previous UI tasks)

**Breakdown:**
- Code splitting & lazy loading: 2 hours
- Loading states & skeletons: 1.5 hours
- Error boundaries: 1 hour
- Toast notifications: 1 hour
- Form validation: 1 hour
- Animations & polish: 1.5 hours
- Cross-browser testing: 2 hours
- Performance audits & fixes: 1.5 hours

## Definition of Done

- [ ] Bundle size <300KB gzipped
- [ ] Lighthouse Performance score >90
- [ ] All routes lazy-loaded
- [ ] Loading states implemented everywhere
- [ ] Error boundaries catch all errors
- [ ] Toast notifications work for actions
- [ ] Forms validate with helpful errors
- [ ] Animations are smooth (60fps)
- [ ] Works in all major browsers
- [ ] No console errors in production
- [ ] Bundle visualizer shows no unexpected large chunks

## Notes

- Use `npm run build:analyze` to inspect bundle composition
- Test with throttled network (Chrome DevTools: Fast 3G)
- Use React DevTools Profiler to find slow components
- Consider using `react-window` for very long request lists (>1000 items)
- Add Service Worker for offline support (future enhancement)
- Consider PWA manifest for mobile (future enhancement)
- Test with screen readers for accessibility

## References

- Vite Code Splitting: https://vitejs.dev/guide/features.html#code-splitting
- React.lazy: https://react.dev/reference/react/lazy
- Lighthouse CI: https://github.com/GoogleChrome/lighthouse-ci
- Web Vitals: https://web.dev/vitals/
